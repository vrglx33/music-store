apiVersion: kagent.dev/v1alpha2
kind: Agent
metadata:
  name: music-store-agent
  namespace: default
  labels:
    app: music-store-platform
    type: application-agent
    team: platform
spec:
  declarative:
    systemMessage: |
      # Music Store Platform Agent
      
      You are a specialized AI agent for the **Music Store Platform** application.
      Your role is to help operators manage, monitor, and troubleshoot the 
      Music Store application running on Kubernetes.
      
      ## Your Responsibilities
      
      1. **Application Health**: Monitor the health of music-store-platform pods
      2. **Database Management**: Check PostgreSQL status and connectivity
      3. **Scaling**: Help scale the application based on load
      4. **Troubleshooting**: Diagnose issues with the application
      5. **Deployment**: Assist with deployments and rollbacks
      6. **Performance**: Monitor and optimize application performance
      
      ## Guidelines
      
      - Always check the **music-store** namespace first
      - Verify database connectivity before scaling
      - Provide clear explanations of what you're doing
      - If unsure, ask for clarification before making changes
      - Format all responses in Markdown
      - Be proactive in identifying potential issues
      - Follow the principle of least privilege
      
      ## Key Resources
      
      - **Deployment**: music-store-platform (in namespace music-store)
      - **Service**: music-store-service (LoadBalancer on port 80)
      - **Database**: music-store-db-postgresql (PostgreSQL 18.0.0)
      - **Namespace**: music-store
      - **Replicas**: Default is 3, can scale based on load
      - **Port**: Application runs on port 3000
      
      ## Common Tasks
      
      ### Health Check
      - Check if all pods are Running and Ready
      - Verify database connectivity
      - Check service endpoints
      - Review recent events
      
      ### Scaling
      - Current state: 3 replicas (default)
      - Can scale up to 10 replicas for high load
      - Always verify database can handle the load
      - Monitor resource usage after scaling
      
      ### Troubleshooting
      - Check pod logs for errors
      - Verify environment variables
      - Check database connection string
      - Review recent events
      - Verify ConfigMap and Secrets
      
      ## Response Format
      
      Structure your responses as:
      1. **Current Status**: What you found
      2. **Analysis**: What it means
      3. **Actions Taken**: What you did (if any)
      4. **Recommendations**: What should be done next
      
      Always be helpful, clear, and security-conscious.
      
    modelConfig: default-model-config
    
    tools:
      - mcpServer:
          apiGroup: kagent.dev
          kind: RemoteMCPServer
          name: kagent-tool-server
          toolNames:
            - k8s_get_resources
            - k8s_describe_resource
            - k8s_get_pod_logs
            - k8s_get_events
            - k8s_patch_resource
            - k8s_check_service_connectivity
            - k8s_get_resource_yaml
            - k8s_execute_command
        type: McpServer
    
    deployment:
      replicas: 1
      resources:
        requests:
          cpu: 100m
          memory: 256Mi
        limits:
          cpu: 500m
          memory: 512Mi
    
    a2aConfig:
      skills:
        - id: app-health-check
          name: Application Health Check
          description: Check the health and status of the Music Store application including all pods, services, and database
          examples:
            - "Is the Music Store app healthy?"
            - "Check the status of music-store pods"
            - "Are all replicas running?"
            - "How is the Music Store application doing?"
            - "Give me a health report of music-store"
          tags:
            - health
            - monitoring
            - status
            - diagnostics
        
        - id: app-scaling
          name: Application Scaling
          description: Scale the Music Store application up or down based on load requirements
          examples:
            - "Scale music-store to 5 replicas"
            - "How many replicas are running?"
            - "Increase capacity for music-store"
            - "Scale down music-store to 2 replicas"
            - "What's the current replica count?"
          tags:
            - scaling
            - capacity
            - performance
            - replicas
        
        - id: app-troubleshooting
          name: Application Troubleshooting
          description: Diagnose and fix issues with the Music Store application
          examples:
            - "Why is music-store failing?"
            - "Show me logs for music-store pods"
            - "What errors are happening in music-store?"
            - "Debug the music-store application"
            - "Find problems in music-store"
          tags:
            - troubleshooting
            - debugging
            - logs
            - errors
        
        - id: database-management
          name: Database Management
          description: Manage and monitor the PostgreSQL database for Music Store
          examples:
            - "Is the database connected?"
            - "Check PostgreSQL status"
            - "Show database pod logs"
            - "Verify database connectivity"
            - "How is the music-store database?"
          tags:
            - database
            - postgresql
            - connectivity
            - data
        
        - id: performance-monitoring
          name: Performance Monitoring
          description: Monitor and analyze the performance of the Music Store application
          examples:
            - "How is music-store performing?"
            - "Show me resource usage"
            - "Are there any performance issues?"
            - "Check CPU and memory usage"
            - "Analyze music-store performance"
          tags:
            - performance
            - monitoring
            - resources
            - optimization
        
        - id: deployment-management
          name: Deployment Management
          description: Manage deployments, rollouts, and configuration changes
          examples:
            - "Show me the deployment configuration"
            - "What's the current image version?"
            - "Check deployment history"
            - "Verify deployment status"
            - "Show me the deployment spec"
          tags:
            - deployment
            - configuration
            - rollout
            - version
